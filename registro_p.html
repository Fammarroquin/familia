<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reg√≠strate</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header id="main-header">
        <h1>Familia Marroqu√≠n Uculmana</h1>
        <nav id="main-nav" class="navbar navbar-expand-lg navbar-light">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div id="navbarNav" class="collapse navbar-collapse">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html#home">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="nuestra-historia.html">Nuestra Historia</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="registro.html">Reg√≠strate</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="registro_p.html">Blog de Comentarios</a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <section id="formulario-registro" class="container mt-5">
        <h2>Reg√≠strate</h2>
        <form id="registro-form">
            <div class="form-group">
                <label for="parentesco">
                    <i class="fas fa-users" style="color: #f39c12;"></i> ¬øQu√© eres de Pap√° Toto y Mam√° Peta?
                </label>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="parentesco" id="soy-hijo" value="hijo">
                    <label class="form-check-label" for="soy-hijo">Soy hijo(a)</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="parentesco" id="soy-nieto" value="nieto">
                    <label class="form-check-label" for="soy-nieto">Soy nieto(a)</label>
                </div>
            </div>

            <!-- Campos comunes -->
            <div class="form-group">
                <label for="nombres"><i class="fas fa-user" style="color: #e74c3c;"></i> Nombres:</label>
                <input type="text" class="form-control" id="nombres" name="nombres" required>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="fecha_cumple"><i class="fas fa-birthday-cake" style="color: #f1c40f;"></i> Fecha de cumplea√±os:</label>
                    <input type="date" class="form-control" id="fecha_cumple" name="fecha_cumple" required>
                </div>
                <div class="form-group col-md-6">
                    <label for="edad"><i class="fas fa-hourglass-half" style="color: #3498db;"></i> Edad actual:</label>
                    <input type="text" class="form-control" id="edad" name="edad" readonly>
                </div>
            </div>
            <div class="form-group">
                <label for="apodo"><i class="fas fa-user-ninja" style="color: #9b59b6;"></i> M√°s conocido como:</label>
                <input type="text" class="form-control" id="apodo" name="apodo" required>
            </div>
            <div class="form-group">
                <label for="email"><i class="fas fa-envelope" style="color: #2ecc71;"></i> Correo electr√≥nico:</label>
                <input type="email" class="form-control" id="email" name="email" required>
            </div>

            <!-- Campos adicionales para "nieto" -->
            <div id="extra-nieto" class="formulario-oculto">
                <div class="form-group">
                    <label for="parentesco_nieto"><i class="fas fa-child" style="color: #8e44ad;"></i> tu pap√° o mam√° es:</label>
                    <select class="form-control" id="parentesco_nieto" name="parentesco_nieto">
                        <option value="">Cargando...</option>
                    </select>
                </div>
            </div>
            

            <button type="submit" class="btn btn-primary">Enviar</button>
        </form>
    </section>
   <!-- Secci√≥n del banner flotante (inicialmente oculto) -->
<div id="mensaje-banner" class="alert-banner" style="display: none;">
    <p id="mensaje-banner-texto"></p>
    <button id="cerrar-banner" class="btn btn-primary">Aceptar</button>
</div>

<!-- Audio de √©xito -->
<audio id="sonido-exito">
    <source src="music/mario-bros-wonderful.mp3" type="audio/mp3">
    Tu navegador no soporta el elemento de audio.
</audio>

<section id="lista-registros" class="container mt-5">
    <h2>Registros</h2>
    <table id="tabla-registros" class="table table-bordered">
        <thead>
            <tr>
                <th>Parentesco</th>
                <th>Nombres</th>
                <th>Fecha de Cumplea√±os</th>
                <th>Edad</th>
                <th>Apodo</th>
                <th>Email</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</section>

    <script>
        // Mostrar campos adicionales para "nieto"
document.getElementById('soy-nieto').addEventListener('change', function() {
    document.getElementById('extra-nieto').classList.remove('formulario-oculto');
    cargarParentescoNieto();
});

document.getElementById('soy-hijo').addEventListener('change', function() {
    document.getElementById('extra-nieto').classList.add('formulario-oculto');
});

// Cargar los nombres y apodos de "hijo" desde Google Sheets
function cargarParentescoNieto() {
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxXjUvof0uqffLfrGK4-y8sbRo1AleGzi5U8V0itKXaxtiQXGx5XgsfeWzcgUdpAkGF/exec'; // Tu WebApp URL

    fetch(scriptURL)
        .then(response => response.json())
        .then(data => {
            const select = document.getElementById('parentesco_nieto');
            select.innerHTML = ''; // Limpiar opciones existentes
            data.forEach(item => {
                const option = document.createElement('option');
                option.value = item.nombre;
                option.textContent = `${item.nombre} (${item.apodo})`;
                select.appendChild(option);
            });
        })
        .catch(error => console.error('Error cargando datos!', error));
}
        // Calcular la edad basado en la fecha de cumplea√±os
        document.getElementById('fecha_cumple').addEventListener('change', function () {
            const cumpleanos = new Date(this.value);
            const hoy = new Date();
            let edad = hoy.getFullYear() - cumpleanos.getFullYear();
            const mes = hoy.getMonth() - cumpleanos.getMonth();

            if (mes < 0 || (mes === 0 && hoy.getDate() < cumpleanos.getDate())) {
                edad--;
            }

            document.getElementById('edad').value = edad;
        });

        // Enviar datos al Google Apps Script
        document.getElementById("registro-form").addEventListener("submit", function(e) {
            e.preventDefault();
            
            const scriptURL = 'https://script.google.com/macros/s/AKfycbxXjUvof0uqffLfrGK4-y8sbRo1AleGzi5U8V0itKXaxtiQXGx5XgsfeWzcgUdpAkGF/exec'; 
            const formData = new FormData(document.getElementById("registro-form"));

            fetch(scriptURL, { method: 'POST', body: formData })
                .then(response => alert('Registro enviado exitosamente'))
                .catch(error => console.error('Error!', error.message));
        });
    </script>
    <script>
        document.getElementById("registro-form").addEventListener("submit", function(e) {
            e.preventDefault();
            
            const scriptURL = 'https://script.google.com/macros/s/AKfycbxXjUvof0uqffLfrGK4-y8sbRo1AleGzi5U8V0itKXaxtiQXGx5XgsfeWzcgUdpAkGF/exec'; 
            const formData = new FormData(document.getElementById("registro-form"));
        
            fetch(scriptURL, { method: 'POST', body: formData })
                .then(response => response.json())
                .then(data => {
                    // Mostrar el banner flotante con el mensaje personalizado
                    const banner = document.getElementById("mensaje-banner");
                    const textoBanner = document.getElementById("mensaje-banner-texto");
                    const sonidoExito = document.getElementById("sonido-exito");
        
                    textoBanner.textContent = `‚úÖ ¬°LISTO! ENVIADO ${data.apodo} üòé`;  // Personaliza el mensaje con el apodo
                    banner.style.display = "flex";  // Muestra el banner
                    sonidoExito.play();  // Reproduce el sonido de √©xito
                })
                .catch(error => console.error('Error!', error.message));
        });
        
        // Cerrar el banner flotante y limpiar el formulario
        document.getElementById("cerrar-banner").addEventListener("click", function() {
            const banner = document.getElementById("mensaje-banner");
            banner.style.display = "none";  // Ocultar el banner
            document.getElementById("registro-form").reset();  // Limpiar el formulario
        });
        </script>
        <script>
            // Funci√≥n para cargar los registros y mostrarlos en la tabla
            function cargarRegistros() {
                const scriptURL = 'https://script.google.com/macros/s/AKfycbxXjUvof0uqffLfrGK4-y8sbRo1AleGzi5U8V0itKXaxtiQXGx5XgsfeWzcgUdpAkGF/exec';  // URL de obtenerRegistros
                fetch(scriptURL)
                    .then(response => response.json())
                    .then(data => {
                        const tbody = document.getElementById("tabla-registros").getElementsByTagName('tbody')[0];
                        tbody.innerHTML = '';  // Limpiar la tabla
                        
                        data.forEach(registro => {
                            const row = tbody.insertRow();
                            row.innerHTML = `
                                <td><input type="text" class="form-control" value="${registro.parentesco}" /></td>
                                <td><input type="text" class="form-control" value="${registro.nombres}" /></td>
                                <td><input type="date" class="form-control" value="${registro.fecha_cumple}" /></td>
                                <td><input type="text" class="form-control" value="${registro.edad}" /></td>
                                <td><input type="text" class="form-control" value="${registro.apodo}" /></td>
                                <td><input type="email" class="form-control" value="${registro.email}" /></td>
                                <td>
                                    <button class="btn btn-success" onclick="guardarCambios(${registro.id})">Guardar</button>
                                </td>
                            `;
                        });
                    })
                    .catch(error => console.error('Error al cargar los registros!', error));
            }
            
            // Llamar a la funci√≥n cuando cargue la p√°gina
            cargarRegistros();
            </script>
<script>
    // Funci√≥n para guardar los cambios de un registro
    function guardarCambios(id) {
        const row = document.querySelector(`#tabla-registros tbody tr:nth-child(${id - 1})`);
        const formData = new FormData();
        
        formData.append('id', id);
        formData.append('parentesco', row.cells[0].querySelector('input').value);
        formData.append('nombres', row.cells[1].querySelector('input').value);
        formData.append('fecha_cumple', row.cells[2].querySelector('input').value);
        formData.append('edad', row.cells[3].querySelector('input').value);
        formData.append('apodo', row.cells[4].querySelector('input').value);
        formData.append('email', row.cells[5].querySelector('input').value);
    
        fetch('https://script.google.com/macros/s/AKfycbwGy7SZZFS0dsfX9T5lxxntpFx1w6zzErzz34z/exec', {  // URL de actualizarRegistro
            method: 'POST',
            body: formData
        })
        .then(response => response.text())
        .then(result => {
            alert(result);  // Mensaje de √©xito
            cargarRegistros();  // Recargar la tabla
        })
        .catch(error => console.error('Error!', error));
    }
    </script>
                
        
</body>
</html>
